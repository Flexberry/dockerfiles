## Предложение по именованию git- и docker- тегов

Сервис автосборки поддерживает богатые возможности по привязке git-тегов к именпм и тегам собираемых образов.

Чтобы не создавалось дополнительной путаницы предлагается стандартизировать процедуру формирования git-тегов для того,
чтобы по имени git-тега можно было однозначно определить имя и теги образа docker-образа (и наоборот).

###  Шаблоны формирования git-тегов

В настоящее время у нас существует два типа образов:

1.  Образы, обеспечивающие определенный стандартный сервис: базы данных (Postgres, ...), WEB-сервис (Apache, Mono), аналитика (Pentaho).
 Для этих образов необходимо обечпечить указание:
 - версий сервиса (postgres:9.6, mono:4.6.2.7, apache:2.4.38, pentaho:8.2, pantaho-saiku:3.17, rabbitmq, ...);
 - версий docker-сборки (0.1.1, 1.0.0, 1.1.0, ...).

2. Образы обеспечивающие сервис, разработанный в рамках организации (flexberry-service-bus-editor, ...). 
У этих образов версия сервиса может совпадать с версией сборки (0.9.1, 1.0.1) и в указании версии сервиса нет необходимости.

В связи в этим предлагается два типа шаблона git-тега:

- **Образы, обеспечивающие определенный стандартный сервис**:

```
<ИмяОбразаБезПрефиксаFlexberry>_<ВерсияСервиса>-<ВерсияСборки>
```

При добавлении тега  такого шаблона формируются алиасные docker-образы:
```
flexberry/<ИмяОбразаБезПрефиксаFlexberry>:<ВерсияСервиса>-<ВерсияСборки>
flexberry/<ИмяОбразаБезПрефиксаFlexberry>:<ВерсияСервиса>
flexberry/<ИмяОбразаБезПрефиксаFlexberry>:latest

```
Например при добавлении тега `alt.p8-apache2-mono_4.6.2.7-1.1.3` формируются docker-образы:
```
flexberry/alt.p8-apache2-mono:4.6.2.7-1.1.3
flexberry/alt.p8-apache2-mono:4.6.2.7
flexberry/alt.p8-apache2-mono:latest
```

- **Образы обеспечивающие сервис, разработанный в рамках организации**:

```
<ИмяОбразаБезПрефиксаFlexberry>_<ВерсияСборки>
```

При добавлении тега  такого шаблона формируются алиасные docker-образы:

```
flexberry/<ИмяОбразаБезПрефиксаFlexberry>:<ВерсияСборки>
flexberry/<ИмяОбразаБезПрефиксаFlexberry>:latest
```

Например при добавлении тега `flexberry-service-bus-editor_1.1.1` формируются docker-образы:

```
flexberry/flexberry-service-bus-editor:1.1.1
flexberry/flexberry-service-bus-editor:latest
```


### Версии сборки (версия сервиса)

Версии сборки (x.y.z) предлагается формировать согласно  [Semantic Versioning 2.0.0](https://semver.org/lang/ru/):

1. Первое число x определяет МАЖОРНУЮ ВЕРСИЮ. 
  Мажорная версия X (X.y.z | X > 0) ДОЛЖНА быть увеличена, если в публичном API представлены какие-либо обратно несовместимые изменения. 

2. Второе число y определяет МИНОРНУЮ ВЕРСИЮ.
  Минорная версия Y (x.Y.z | x > 0) ДОЛЖНА быть увеличена, если в публичном API представлена новая обратно совместимая функциональность.

3. Третье число z определяет ПАТЧ-ВЕРСИЮ.
  Патч-версия Z (x.y.Z | x > 0) ДОЛЖНА быть увеличена только если содержит обратно совместимые баг-фиксы.

Если версия предрелизная, то она должна после дефиса (`-`) содержать имя предрелиза в формате `[0-9A-Za-z-]`, например `1.0.0-alpha.1`.

При такой системе формирования версий есть смысл формировать дополнителые алиасы к формируемым docker-образам 
`flexberry/<ИмяОбразаБезПрефиксаFlexberry>:<ВерсияСервиса>-x.y.z` (flexberry/<ИмяОбразаБезПрефиксаFlexberry>:x.y.z):
- МИНОРНЫЙ docker-образ ``flexberry/<ИмяОбразаБезПрефиксаFlexberry>:<ВерсияСервиса>-x.y` (flexberry/<ИмяОбразаБезПрефиксаFlexberry>:x.y)`
- МАЖОРНЫЙ docker-образ ``flexberry/<ИмяОбразаБезПрефиксаFlexberry>:<ВерсияСервиса>-x` (flexberry/<ИмяОбразаБезПрефиксаFlexberry>:x)

Это позволит при запуске образа (`docker run`, `docker-compose.yml`) или при сборке дочернего образа (в описании FROM Dockerfile)
указывать в зависимости от ситуации МИНОРНЫЙ или МАЖОРНЫЙ ТЕГ,
так как PATCH'евые или МИНОРные правки не должны сказываться на функицональность сервиса.

При использовании этого подхода значительно уменьшатся проблемы, связанные с некорректным формированием docker-образов.

Дополнительные технологические расходы будут минимальны, так как
- если PATH'евый образ совпадает с МИНОРНЫМ и МАЖОРНЫМ, то они имеют одинаковый ID и при смене docker-тега никаких дополнителных 
передачт слоев нового образа не происходит;
-  если PATH'евый образ НЕ совпадает с МИНОРНЫМ и МАЖОРНЫМ, то при смене docker-тега будут передаваться ТОЛЬКО измененные слои образа.

### Примеры

При добавлении тега `alt.p8-apache2-mono_4.6.2.7-1.1.3` формируются docker-образы:

```
flexberry/alt.p8-apache2-mono:4.6.2.7-1.1.3
flexberry/alt.p8-apache2-mono:4.6.2.7-1.1
flexberry/alt.p8-apache2-mono:4.6.2.7-1
flexberry/alt.p8-apache2-mono:4.6.2.7
flexberry/alt.p8-apache2-mono:latest
```

При добавлении тега `flexberry-service-bus-editor_1.1.1` формируются docker-образы:

```
flexberry/flexberry-service-bus-editor:1.1.1
flexberry/flexberry-service-bus-editor:1.1
flexberry/flexberry-service-bus-editor:1
flexberry/flexberry-service-bus-editor:latest
```
