# Описание

Данный образ поддерживает функционал `apache-mono (версия 4.6.2.7)` сервера 
и является базовым оразом для создания специализированных образов 
для запуска apache-mono приложений. 


## Функционал

Начиная с версии 4.6.2.7-1.3.0 поддерживается возможность настройки аргументов тегов XML-файлов.
Если аргумент тега XML-файла содежит шаблон типа `%%ИМЯ_ПЕРЕМЕННОЙ%%`,
то значение данного аргумента заменяется на значение указанной переменной.

Список корректируемых файлов указывается в переменной среды `XMLTEMPLATES`.
Имена файлов в списке разделются пробелами.
Если переменная `XMLTEMPLATES`пучта или не инициализирована корректировки файлов не производятся

При запуске контенера образа должны быть определены все переменные, указанные в шаблонах.
Если хоть одна переменная не опеделена или имеет пустое значение контейнер завершает свою работу.
Переменные среды могут быть заданы следующими способами:
- инициализация в операторе `ENV` файла `Dockerfile` при создании подобраза. Например:
  ```
  FROM flexberry/alt.p8-apache2-mono:4.6.2.7-1.3
  ...
  ENV XMLTEMPLATES "/var/www/web-api/app/Web.config"
  ...
  ```
- инициализация при запуске контейнера через флаг `-e`. Например:
  ```
  $ docker run -e "XMLTEMPLATES=/var/www/web-api/app/Web.config" ...
  ```
  
- инициализацией в YML-файл. 
Например:
  ```
  services:
  monoservice:
    image: ...
      environment:
        - XMLTEMPLATES=/var/www/web-api/app/Web.config

> РЕКОМЕНДУЕТСЯ ПЕРЕМЕННУЮ `XMLTEMPLATES` ИНИЦИАЛИЗИРОАТЬ в Dockerfile ДОЧЕРНЕГО ОБРАЗА. ПЕРЕМЕННЫЕ, ИСПОЛЬЗУЕМЫЕ ДЛЯ КОРЕКТИРОВКИ ЦЕЛЕСООБАЗНЕЕ УКАЗЫВТЬ ПРИ ЗАПУСКЕ КОНТЕЙНЕРА/СЕРВИСА В ПАМЕТАХ ИЛИ YML-ФАЙЛАХ.   

При запуске контейнера/сервиса производится выполнение следующих команд оператора `CMD`:
```
CMD /bin/change_XMLconfig_from_env.sh && \
    /usr/sbin/httpd2 -D NO_DETACH -k start
```
Скрипт `change_XMLconfig_from_env.sh` в файлах, перечисленных в переменной `XMLTEMPLATES`производит корректировку агументов.
В случае успешного завершения запускает WEB-сервис, котоый инициирует запуск сервиса `mono`.

Если в дочерних образах необходимо запустить дополнительные сервисы необходимо переопределить оператор `CMD` в `Dockerfile`. 
