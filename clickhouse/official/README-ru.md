# Описание

Образ основан на стандартом образе [yandex/clickhouse-server](https://hub.docker.com/r/yandex/clickhouse-server).

## Функционал

Данный образ поддерживает следующие возможности:
- Интеграция с базой данных Postgres:
  * Настройка ODBC-драйвера на указаную базу данных Postgres;
  - автоматическое создание clickhouse-словарей из базы данных postres;
  - автоматическое создание clickhouse-таблиц для указанных словарей
  - автоматическое создание (без наполнения) основной (Bigdata) clickhouse-таблицы по указанной из базы данных postres

## Запуск

Для создания внешних словарей на основе таблиц базы данных Postgres определите следующие переменные среды:
- PGServername= домен или IP-адрес сервера Postgres;
- PGPort - порт по которому принимает соединение сервер Postgres (по умолчанию 5432); 
- PGProtocol - тип протокола (версия Postgres сервера) (по умолчанию 9.6)
- PGDatabase - имя базы данных;
- PGUserName - имя пользователя Postgres;
- PGPassword - пароль пользователя Postgres;
- PGDicrionaries - список таблиц для которых необходимо создать внешние словари и соответствующие таблицы ClickHouse; 
- PGBigTable - имя таблицы для которой необходимо создать схему аналогичной таблицы в ClickHouse 

Перед запуском сервере ClickHouse а контейнере образа создаются следующие файлы:
- /etc/odbc.ini - инициализционный файл сервиса ODBC описывающий коннект с сервером Postgres(имя коннекта postgresConnection);
- /etc/clickhouse-server/<PGDatabase>_dictionary.xml - описание внешних словарей, перечисленных в переменной PGDicrionaries  (где <PGDatabase> - имя базы данных).
 
 После запуска сервера ClickHouse  в базе данных PGDatabase создаются перечисленные в переменной PGDicrionaries таблицы ClickHouse типа Dictionary.
 
 Для формирования типа атрибутов таблий ClickHouse производится обращение к описанию атрибутов указанных Postgres-таблиц.
 Маппинг типов атрибутов Postgres в типы атрибутов ClickHouse:
 
 Тип Postgres | Тип ClickHouse | Значение по умолчанию
 -------------|----------------|----------------------
 timestamp .* | DateTime | 0000-00-00 00:00:00
 character .* | String | '' (пустая строка)
 uuid | UUID | 00000000-0000-0000-0000-000000000000
integer [8, 16, 32, 64] | Int8, Int16, Int32, Int64 | -1
boolean | Int8 | 0
numeric | Float64 | 0.0


